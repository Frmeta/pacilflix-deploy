{% extends 'base.html' %}

{% block content %}
{% include 'navbar_aktif.html' %}
<div class="flex items-center justify-center pb-24">
    <div class="text-white rounded-xl w-3/4 m-2">
        <p class="flex justify-center text-4xl mt-24 mb-5 w-full text-white font-bold leading-tight text-center">Downloads</p>
    
        <div class="grid grid-cols-3 gap-y-0 mt-6">
            <p class="font-bold text-md p-2 text-center flex items-center justify-center border-y-2 border-white">Title</p>
            <p class="font-bold text-md p-2 text-center flex items-center justify-center border-y-2 border-white">Timestamp</p>
            <p class="font-bold text-md p-2 text-center flex items-center justify-center border-y-2 border-white">Delete</p>
        </div>
        <div class="grid grid-cols-3 gap-y-0">
            {% for row in rows %}
                <p class="font-normal text-sm p-2 text-center flex items-center justify-center border-y-2 border-white">{{ row.0 }}</p>
                <p class="font-normal text-sm p-2 text-center flex items-center justify-center border-y-2 border-white text-justify">{{ row.1 }}</p>
                <div class="font-normal text-sm p-2 text-center flex items-center justify-center border-y-2 border-white">
                    <button onclick="hapus_unduhan('{{ row.2 }}', '{{ row.1 }}')" class="inline-flex items-center py-2.5 px-6 text-medium font-normal text-center text-white bg-red-500 font-bold rounded-full transition-all hover:bg-red-700">
                        Delete
                    </button>
                </div>
            {% endfor %}
            
            
        </div>
    </div>
</div>



<script>

function hapus_unduhan(tayangan_id, timestampnya) {
    console.log("tayangan id " + tayangan_id + " dengan timestamp " + timestampnya + " akan dihapus dari unduhan")

    $.ajax({
        method: "POST",
        url: "{% url 'hapus_unduhan' %}",
        data: {
            id : tayangan_id,
            timestamp : timestampnya
        },
        success: function( result ) {
            if (result.status == "success"){
                console.log("success deleting tayangan from download list")
                window.location.reload()


            } else if (result.status = 'failed'){
                <!-- show snackbar -->
                var x = document.getElementById("snackbar");
                x.className = "show";
                x.innerHTML = result.message;
                setTimeout(function(){ x.className = x.className.replace("show", ""); }, 3000);
            } else{
                console.log("huh??")
            }
        },
        error: function( result ) {
            console.log("failed adding to download list" + result.responseText)
            
        }
    });
}


</script>

{% endblock content %}